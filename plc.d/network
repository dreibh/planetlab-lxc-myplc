#!/bin/bash
#
# priority: 100
#
# Manage network related configuration files
#
# Mark Huang <mlhuang@cs.princeton.edu>
# Copyright (C) 2006 The Trustees of Princeton University
#
# $Id: network,v 1.1 2006/04/06 21:51:59 mlhuang Exp $
#

# Source function library and configuration
. /etc/plc.d/functions
. /etc/planetlab/plc_config

case "$1" in
    start)
	MESSAGE=$"Generating network files"
	dialog "$MESSAGE"

	# Minimal /etc/hosts
	echo "127.0.0.1	localhost.localdomain localhost" >/etc/hosts
	(
	    for server in API BOOT WWW ; do
		hostname=PLC_${server}_HOST
		ip=$(gethostbyname ${!hostname})
		if [ -n "$ip" ] ; then
		    echo "$ip	$hostname"
		fi
	    done
	) >>/etc/hosts

	# Set up nameservers
	(
	    [ -n "$PLC_NET_DNS1" ] && echo "nameserver $PLC_NET_DNS1"
	    [ -n "$PLC_NET_DNS2" ] && echo "nameserver $PLC_NET_DNS2"
	) >/etc/resolv.conf

	result "$MESSAGE"
	;;
esac

exit $ERRORS
